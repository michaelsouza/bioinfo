function [x,g] = mdgp_rotate(theta,p,y,z)
%ROTATE
%    Y = ROTATE(THETA,P,Y,Z)

%    This function was generated by the Symbolic Math Toolbox version 6.2.
%    16-Jan-2017 17:25:30

p1=p(1);p2=p(2);p3=p(3);
y1=y(1);y2=y(2);y3=y(3);
z1=z(1);z2=z(2);z3=z(3);

t7 = y1-z1;
t2 = abs(t7);
t3 = y2-z2;
t4 = abs(t3);
t6 = y3-z3;
t5 = abs(t6);
t8 = t2.^2;
t9 = t4.^2;
t10 = t5.^2;
t11 = t8+t9+t10;
t12 = 1.0./sqrt(t11);
t13 = cos(theta);
t14 = 1.0./t11;
t15 = p3.*t3.*t12;
t16 = t6.*t12.*y2;
t17 = t15+t16-p2.*t6.*t12-t3.*t12.*y3;
t18 = sin(theta);
t19 = t3.^2;
t20 = t14.*t19;
t21 = t6.^2;
t22 = t14.*t21;
t23 = t20+t22;
t24 = t23.*y1;
t25 = p1.*t7.*t12;
t26 = p2.*t3.*t12;
t27 = p3.*t6.*t12;
t35 = t3.*t12.*y2;
t36 = t6.*t12.*y3;
t28 = t25+t26+t27-t35-t36;
t29 = t7.*t12.*t28;
t30 = t24+t29;
t31 = t13-1.0;
t32 = sign(t7);
t33 = 1.0./t11.^(3.0./2.0);
t34 = 1.0./t11.^2;
t37 = sign(t3);
t38 = sign(t6);
t39 = t6.*t12;
t40 = p3.*t12;
t41 = t3.*t12;
t42 = t12.*y2;
t43 = t2.*t19.*t32.*t34.*2.0;
t44 = t2.*t21.*t32.*t34.*2.0;
t45 = t43+t44;
t46 = t12.*t28;
t47 = p1.*t12;
t48 = t2.*t3.*t32.*t33.*y2;
t49 = t2.*t6.*t32.*t33.*y3;
t90 = p1.*t2.*t7.*t32.*t33;
t91 = p2.*t2.*t3.*t32.*t33;
t92 = p3.*t2.*t6.*t32.*t33;
t50 = t47+t48+t49-t90-t91-t92;
t51 = t7.*t12.*t50;
t52 = p3.*t2.*t3.*t32.*t33;
t53 = t2.*t6.*t32.*t33.*y2;
t54 = t52+t53-p2.*t2.*t6.*t32.*t33-t2.*t3.*t32.*t33.*y3;
t55 = y2.*2.0;
t132 = z2.*2.0;
t56 = t55-t132;
t57 = t4.*t19.*t34.*t37.*2.0;
t58 = t4.*t21.*t34.*t37.*2.0;
t133 = t14.*t56;
t59 = t57+t58-t133;
t60 = t59.*y1;
t61 = p2.*t12;
t62 = p1.*t4.*t7.*t33.*t37;
t63 = p2.*t3.*t4.*t33.*t37;
t64 = p3.*t4.*t6.*t33.*t37;
t65 = t4.*t7.*t28.*t33.*t37;
t66 = t12.*y3;
t67 = p2.*t4.*t6.*t33.*t37;
t68 = t3.*t4.*t33.*t37.*y3;
t69 = y3.*2.0;
t94 = z3.*2.0;
t70 = t69-t94;
t71 = t5.*t19.*t34.*t38.*2.0;
t72 = t5.*t21.*t34.*t38.*2.0;
t95 = t14.*t70;
t73 = t71+t72-t95;
t74 = t73.*y1;
t75 = p1.*t5.*t7.*t33.*t38;
t76 = p2.*t3.*t5.*t33.*t38;
t77 = p3.*t5.*t6.*t33.*t38;
t78 = t5.*t7.*t28.*t33.*t38;
t79 = p3.*t3.*t5.*t33.*t38;
t80 = t5.*t6.*t33.*t38.*y2;
t81 = t7.^2;
t82 = p1.*t6.*t12;
t83 = t7.*t12.*y3;
t84 = t14.*t81;
t85 = t22+t84;
t86 = t85.*y2;
t93 = t7.*t12.*y1;
t87 = t25+t26+t27-t36-t93;
t88 = t3.*t12.*t87;
t89 = t86+t88;
t96 = t7.*t12;
t97 = t12.*y1;
t98 = y1.*2.0;
t130 = z1.*2.0;
t99 = t98-t130;
t100 = t2.*t32.*t34.*t81.*2.0;
t131 = t14.*t99;
t101 = t44+t100-t131;
t102 = t101.*y2;
t103 = t2.*t3.*t32.*t33.*t87;
t104 = p1.*t2.*t6.*t32.*t33;
t105 = t2.*t7.*t32.*t33.*y3;
t106 = t4.*t34.*t37.*t81.*2.0;
t107 = t58+t106;
t108 = t12.*t87;
t109 = t4.*t7.*t33.*t37.*y1;
t110 = t4.*t6.*t33.*t37.*y3;
t111 = t61-t62-t63-t64+t109+t110;
t112 = t3.*t12.*t111;
t113 = p1.*t4.*t6.*t33.*t37;
t114 = t4.*t7.*t33.*t37.*y3;
t115 = t5.*t34.*t38.*t81.*2.0;
t116 = t72-t95+t115;
t117 = t116.*y2;
t118 = t3.*t5.*t33.*t38.*t87;
t119 = p3.*t5.*t7.*t33.*t38;
t120 = t5.*t6.*t33.*t38.*y1;
t121 = p1.*t3.*t12;
t122 = t7.*t12.*y2;
t123 = t121+t122-p2.*t7.*t12-t3.*t12.*y1;
t124 = t20+t84;
t125 = t124.*y3;
t126 = t25+t26+t27-t35-t93;
t127 = t6.*t12.*t126;
t128 = t125+t127;
t129 = t3.*t12.*t18;
t134 = t43+t100-t131;
t135 = t134.*y3;
t136 = t2.*t6.*t32.*t33.*t126;
t137 = p1.*t2.*t3.*t32.*t33;
t138 = t2.*t7.*t32.*t33.*y2;
t139 = t57+t106-t133;
t140 = t139.*y3;
t141 = t4.*t6.*t33.*t37.*t126;
t142 = p2.*t4.*t7.*t33.*t37;
t143 = t3.*t4.*t33.*t37.*y1;
t144 = t71+t115;
t145 = t12.*t126;
t146 = t5.*t7.*t33.*t38.*y1;
t147 = t3.*t5.*t33.*t38.*y2;
t148 = t40-t75-t76-t77+t146+t147;
t149 = t6.*t12.*t148;
t150 = p1.*t3.*t5.*t33.*t38;
t151 = t5.*t7.*t33.*t38.*y2;
t152 = t150+t151-p2.*t5.*t7.*t33.*t38-t3.*t5.*t33.*t38.*y1;
t153 = t18.*t152;
x = [p1.*t13+t17.*t18-t30.*t31;
     p2.*t13-t31.*t89+t18.*(t82+t83-p3.*t7.*t12-t6.*t12.*y1);
     p3.*t13-t18.*t123-t31.*t128];
g = reshape([-p1.*t18+t13.*t17+t18.*t30,-p2.*t18+t18.*t89+t13.*(t82+t83-p3.*t7.*t12-t6.*t12.*y1),-p3.*t18-t13.*t123+t18.*t128,t13-t14.*t31.*t81,t6.*t12.*t18-t3.*t7.*t14.*t31,-t129-t6.*t7.*t14.*t31,-t6.*t12.*t18-t3.*t7.*t14.*t31,t13-t14.*t19.*t31,t7.*t12.*t18-t3.*t6.*t14.*t31,t129-t6.*t7.*t14.*t31,-t7.*t12.*t18-t3.*t6.*t14.*t31,t13-t14.*t21.*t31,-t18.*t54-t31.*(t20+t22+t46+t51-t45.*y1-t2.*t7.*t28.*t32.*t33),-t18.*(t39+t40-t66+t104+t105-p3.*t2.*t7.*t32.*t33-t2.*t6.*t32.*t33.*y1)+t31.*(t102+t103+t3.*t12.*(-t47-t49+t90+t91+t92+t96+t97-t2.*t7.*t32.*t33.*y1)),t18.*(t41-t42+t61+t137+t138-p2.*t2.*t7.*t32.*t33-t2.*t3.*t32.*t33.*y1)+t31.*(t135+t136+t6.*t12.*(-t47-t48+t90+t91+t92+t96+t97-t2.*t7.*t32.*t33.*y1)),t18.*(t39+t40+t67+t68-t12.*y3-p3.*t3.*t4.*t33.*t37-t4.*t6.*t33.*t37.*y2)+t31.*(t60+t65+t7.*t12.*(t41+t42+t62+t63+t64-p2.*t12-t3.*t4.*t33.*t37.*y2-t4.*t6.*t33.*t37.*y3)),-t18.*(t113+t114-p3.*t4.*t7.*t33.*t37-t4.*t6.*t33.*t37.*y1)-t31.*(t22+t84+t108+t112-t107.*y2-t3.*t4.*t33.*t37.*t87),-t18.*(t47+t96-t97+t142+t143-p1.*t3.*t4.*t33.*t37-t4.*t7.*t33.*t37.*y2)+t31.*(t140+t141+t6.*t12.*(t41+t42-t61+t62+t63+t64-t109-t3.*t4.*t33.*t37.*y2)),-t18.*(t41-t42+t61+t79+t80-p2.*t5.*t6.*t33.*t38-t3.*t5.*t33.*t38.*y3)+t31.*(t74+t78+t7.*t12.*(t39-t40+t66+t75+t76+t77-t3.*t5.*t33.*t38.*y2-t5.*t6.*t33.*t38.*y3)),t18.*(t47+t96-t97+t119+t120-p1.*t5.*t6.*t33.*t38-t5.*t7.*t33.*t38.*y3)+t31.*(t117+t118+t3.*t12.*(t39-t40+t66+t75+t76+t77-t5.*t7.*t33.*t38.*y1-t5.*t6.*t33.*t38.*y3)),t153-t31.*(t20+t84+t145+t149-t144.*y3-t5.*t6.*t33.*t38.*t126),t31.*(t46+t51-t45.*y1-t2.*t7.*t28.*t32.*t33)+t18.*t54,t18.*(t40-t66+t104+t105-p3.*t2.*t7.*t32.*t33-t2.*t6.*t32.*t33.*y1)-t31.*(t102+t103+t3.*t12.*(-t47-t49+t90+t91+t92+t97-t2.*t7.*t32.*t33.*y1)),t18.*(t42-t61-t137-t138+p2.*t2.*t7.*t32.*t33+t2.*t3.*t32.*t33.*y1)-t31.*(t135+t136+t6.*t12.*(-t47-t48+t90+t91+t92+t97-t2.*t7.*t32.*t33.*y1)),-t18.*(t40-t66+t67+t68-p3.*t3.*t4.*t33.*t37-t4.*t6.*t33.*t37.*y2)-t31.*(t60+t65+t7.*t12.*(t42-t61+t62+t63+t64-t3.*t4.*t33.*t37.*y2-t4.*t6.*t33.*t37.*y3)),t31.*(t108+t112-t107.*y2-t3.*t4.*t33.*t37.*t87)+t18.*(t113+t114-p3.*t4.*t7.*t33.*t37-t4.*t6.*t33.*t37.*y1),t18.*(t47-t97+t142+t143-p1.*t3.*t4.*t33.*t37-t4.*t7.*t33.*t37.*y2)-t31.*(t140+t141+t6.*t12.*(t42-t61+t62+t63+t64-t109-t3.*t4.*t33.*t37.*y2)),-t18.*(t42-t61-t79-t80+p2.*t5.*t6.*t33.*t38+t3.*t5.*t33.*t38.*y3)-t31.*(t74+t78+t7.*t12.*(-t40+t66+t75+t76+t77-t3.*t5.*t33.*t38.*y2-t5.*t6.*t33.*t38.*y3)),-t18.*(t47-t97+t119+t120-p1.*t5.*t6.*t33.*t38-t5.*t7.*t33.*t38.*y3)-t31.*(t117+t118+t3.*t12.*(-t40+t66+t75+t76+t77-t5.*t7.*t33.*t38.*y1-t5.*t6.*t33.*t38.*y3)),-t153+t31.*(t145+t149-t144.*y3-t5.*t6.*t33.*t38.*t126)],3,[]);